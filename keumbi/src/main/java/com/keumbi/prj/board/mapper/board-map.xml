<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.keumbi.prj.board.mapper.BoardMapper">
	
	<select id="selectBoardList" resultType="BoardVO">
	<![CDATA[
			SELECT 	*
			FROM 	( SELECT 	ROWNUM AS RNUM, T.*
					  FROM 		( SELECT 	*
                        		  FROM 		BOARDS
                        		  ORDER BY 	BOD_NUM ) T
					  WHERE 	ROWNUM <= #{totalNo} - ((#{pageNo} - 1) * #{pageScale})
                	  ORDER BY 	BOD_NUM DESC
			)
			WHERE 	#{totalNo} - (#{pageNo} * #{pageScale}) + 1 <= RNUM
            ORDER BY BOD_NUM DESC
	]]>
	</select>

	<select id="boradView" resultType="BoardVO">
		SELECT 	*
		FROM 	BOARDS	
		WHERE 	BOD_NUM = #{bod_num}
	</select>
	
	<update id="boardHit" parameterType="BoardVO">
		UPDATE 	BOARDS
		SET 	HIT = HIT + 1
		WHERE 	BOD_NUM = #{bod_num}
	</update>
   
	<select id="tagSelect" resultType="BoardKwdVO">
		SELECT	C.VAL, KWD_CODE
		FROM 	BOD_KWD B, COMMON_CODE C
		WHERE 	B.KWD_CODE = C.CODE
		AND 	B.BOD_NUM = #{bod_num}
	</select>
	
	<insert id="boardInsert" parameterType="BoardVO">
		<selectKey keyProperty="bod_num" resultType="int" order="BEFORE">
			SELECT 	NVL(MAX(BOD_NUM), 0)+1
			FROM 	BOARDS
		</selectKey>
		INSERT INTO BOARDS ( BOD_NUM, USER_ID, TITLE, CONTENTS, WDATE, BOD_CODE, HIT)
		VALUES ( #{bod_num}, #{user_id}, #{title}, #{contents}, TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 'T1', #{hit} )
	</insert>
	
	<insert id="boardKwdInsert" parameterType="BoardKwdVO">
		INSERT INTO BOD_KWD
		VALUES ( #{kwd_code}, #{bod_num} )
	</insert>
	
	<update id="boardUpdate" parameterType="BoardVO">
		UPDATE BOARDS
		SET TITLE = #{title}, CONTENTS = #{contents}
		WHERE BOD_NUM = #{bod_num}
    </update>
	
	<delete id="boardKwdDelete" parameterType="int">
		DELETE FROM BOD_KWD
		WHERE BOD_NUM = #{bod_num}
	</delete>
	
	<delete id="boardDelete" parameterType="BoardVO">
		DELETE FROM BOARDS 
		WHERE BOD_NUM = #{bod_num}
	</delete>
	
	<select id="boardCount" resultType="int">
		SELECT 	COUNT(*)
		FROM 	BOARDS
	</select>
	
	<select id="boardSearch" resultType="BoardVO">
         SELECT 	*
         FROM 		BOARDS
         WHERE    
         <if test="key == 't'">
         	TITLE LIKE '%' || #{val} || '%'
         </if>
         <if test="key == 'c'">
         	CONTENTS LIKE '%' || #{val} || '%'
         </if>   
         <if test="key == 'tc'">
         	TITLE LIKE '%' || #{val} || '%' OR CONTENTS LIKE '%' || #{val } || '%'
         </if>  
         ORDER BY 	BOD_NUM DESC 
   </select>
	

</mapper>