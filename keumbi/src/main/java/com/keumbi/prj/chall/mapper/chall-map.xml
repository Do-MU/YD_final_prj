<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.keumbi.prj.chall.mapper.ChallMapper">
	<select id="challList" resultType="ChallVO" parameterType="String">
		SELECT	NUM, USER_ID, GOAL, CHALL_CODE, CHALL_NUM, CEIL(EDATE-SYSDATE) "dDay"
		FROM	CHALLS
		WHERE	USER_ID = #{id}
	</select>
	
	<select id="challTotalUser" resultType="int">
		SELECT	COUNT(USER_ID)
		FROM	CHALLS
		WHERE	CHALL_NUM = #{chall_num}
	</select>
	
	<insert id="challInsert" parameterType="ChallVO">
		INSERT INTO CHALLS
		VALUES ((SELECT NVL(MAX(NUM), 0) + 1 FROM CHALLS)
				, #{user_id}, TO_CHAR(SYSDATE, 'YYYY-MM-DD'), TO_CHAR(SYSDATE+30, 'YYYY-MM-DD'), #{goal}, 'CH1', #{chall_num})   
	</insert>
	
	<select id="challSelect" parameterType="ChallVO" resultType="int">
		SELECT	COUNT(*)
		FROM	CHALLS
		WHERE	CHALL_NUM = #{chall_num}
		AND		USER_ID   = #{user_id}
	</select>
	
	<select id="userAmtSumA" resultType="ChallVO" parameterType="Integer">
       SELECT NVL(SUM(AMT),0) AMT
	   FROM   TOTAL_TRANS
	   WHERE  CAT_CODE = ( SELECT 	VAL
                           FROM 	COMMON_CODE
                           WHERE 	CODE = ( SELECT 	CATEGORY
                           				  	 FROM		PRD_CHALLS
                           				  	 WHERE		NUM = #{chall_num} ) )
	   AND USER_ID = #{user_id}
	   AND TDATE BETWEEN #{sdate} AND #{edate}
	   ORDER BY 3 DESC
   </select>
   
   <select id="userAmtSumB" resultType="LedgerVO" parameterType="String">
   </select>
</mapper>